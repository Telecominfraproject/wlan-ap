From ba7a1aa768715d9a533f9c402e30ee7baea9f35b Mon Sep 17 00:00:00 2001
From: John Crispin <john@phrozen.org>
Date: Thu, 11 Dec 2025 08:02:16 +0100
Subject: [PATCH 902/903] libubox: update to version used in v4.2

Signed-off-by: John Crispin <john@phrozen.org>
---
 package/libs/libubox/Makefile                       |  8 ++++----
 .../libs/libubox/patches/001-CLOCK_BOOTTIME.patch   | 13 +++++++++++++
 2 files changed, 17 insertions(+), 4 deletions(-)
 create mode 100644 package/libs/libubox/patches/001-CLOCK_BOOTTIME.patch

diff --git a/package/libs/libubox/Makefile b/package/libs/libubox/Makefile
index ad9016edb8..6bba69ed27 100644
--- a/package/libs/libubox/Makefile
+++ b/package/libs/libubox/Makefile
@@ -1,13 +1,13 @@
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=libubox
-PKG_RELEASE=2
+PKG_RELEASE=1
 
 PKG_SOURCE_PROTO:=git
 PKG_SOURCE_URL=$(PROJECT_GIT)/project/libubox.git
-PKG_MIRROR_HASH:=f9f9c631e8167597ce721c64a0023dae9e0f1b2cc37ae846a49984d535a3c480
-PKG_SOURCE_DATE:=2023-07-05
-PKG_SOURCE_VERSION:=75a3b870cace1171faf57bd55e5a9a2f1564f757
+PKG_MIRROR_HASH:=242e33eca235124c7e005d25fbc8f8bf08a324335343e60278d4535c91157ba4
+PKG_SOURCE_DATE:=2024-03-29
+PKG_SOURCE_VERSION:=eb9bcb64185ac155c02cc1a604692c4b00368324
 PKG_ABI_VERSION:=$(call abi_version_str,$(PKG_SOURCE_DATE))
 CMAKE_INSTALL:=1
 
diff --git a/package/libs/libubox/patches/001-CLOCK_BOOTTIME.patch b/package/libs/libubox/patches/001-CLOCK_BOOTTIME.patch
new file mode 100644
index 0000000000..5e78d5ade9
--- /dev/null
+++ b/package/libs/libubox/patches/001-CLOCK_BOOTTIME.patch
@@ -0,0 +1,13 @@
+Index: libubox-2023-05-23-82fa6480/uloop.c
+===================================================================
+--- libubox-2023-05-23-82fa6480.orig/uloop.c
++++ libubox-2023-05-23-82fa6480/uloop.c
+@@ -293,7 +293,7 @@ static void uloop_gettime(struct timeval
+ {
+ 	struct timespec ts;
+ 
+-	clock_gettime(CLOCK_MONOTONIC, &ts);
++	clock_gettime(CLOCK_BOOTTIME, &ts);
+ 	tv->tv_sec = ts.tv_sec;
+ 	tv->tv_usec = ts.tv_nsec / 1000;
+ }
-- 
2.34.1

