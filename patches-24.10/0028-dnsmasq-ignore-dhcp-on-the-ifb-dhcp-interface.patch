From eb74e9e5ef2b449439435a44eaac05b92980e59a Mon Sep 17 00:00:00 2001
From: John Crispin <john@phrozen.org>
Date: Mon, 13 Jun 2022 13:33:31 +0200
Subject: [PATCH 28/55] dnsmasq: ignore dhcp on the ifb-dhcp interface

This would otherwise break spotfilter client detection.

Signed-off-by: John Crispin <john@phrozen.org>
---
 package/network/services/dnsmasq/files/dnsmasq.init | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/package/network/services/dnsmasq/files/dnsmasq.init b/package/network/services/dnsmasq/files/dnsmasq.init
index e9afcc78d3..8acc40d963 100755
--- a/package/network/services/dnsmasq/files/dnsmasq.init
+++ b/package/network/services/dnsmasq/files/dnsmasq.init
@@ -1222,6 +1222,9 @@ dnsmasq_start()
 		[ -n "$BOOT" ] || config_foreach filter_dnsmasq dhcp dhcp_add "$cfg"
 	fi
 
+	xappend "except-interface=ifb-dhcp"
+	xappend "except-interface=spotfilter-ifb"
+	xappend "except-interface=ifb-dhcprelay"
 
 	echo >> "$CONFIGFILE_TMP"
 	config_foreach filter_dnsmasq cname dhcp_cname_add "$cfg"
-- 
2.34.1

